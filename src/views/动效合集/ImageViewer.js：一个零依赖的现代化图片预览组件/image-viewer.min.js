class e extends HTMLElement {
  constructor(e = {}) {
    super(),
      (this.config = {
        targetSelector: "img",
        maxScale: 5,
        minScale: 0.5,
        allowRotate: !0,
        allowDownload: !0,
        ...e,
      }),
      (this.currentScale = 1),
      (this.currentRotation = 0),
      (this.isDragging = !1),
      (this.startX = 0),
      (this.startY = 0),
      (this.currentX = 0),
      (this.currentY = 0),
      (this.imageList = []),
      (this.currentIndex = -1),
      this.attachShadow({ mode: "open" }),
      this.#e();
  }
  #e() {
    this.shadowRoot.innerHTML =
      '\n<style>#overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:rgba(0,0,0,0.5);display:none;justify-content:center;align-items:center;z-index:999999;overflow:hidden;cursor:default;-webkit-user-select:none;-ms-user-select:none;user-select:none}#image-wrapper{position:relative;transform-origin:center center;transition:transform 0.1s ease-out;-webkit-user-select:none;-ms-user-select:none;user-select:none}#preview-img{max-width:90vw;max-height:90vh;object-fit:contain;border:4px solid white;border-radius:4px;cursor:grab;pointer-events:none}#image-wrapper:active #preview-img,#overlay.dragging #preview-img{cursor:grabbing}#overlay.dragging{cursor:grabbing}#loading{color:white;font-size:2em}#nav-controls{position:absolute;top:50%;left:0;width:100%;display:flex;justify-content:space-between;transform:translateY(-50%);padding:0 20px;box-sizing:border-box;z-index:1;pointer-events:none}.nav-btn{pointer-events:auto}#controls{position:absolute;top:20px;right:20px;display:flex;gap:10px;z-index:10}.control-btn,.nav-btn{background-color:rgba(0,0,0,0.7);color:white;border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background-color 0.2s,transform 0.1s ease-in-out;-webkit-user-select:none;-ms-user-select:none;user-select:none}.control-btn:hover,.nav-btn:hover{background-color:#007bff;transform:scale(1.1)}.control-btn{width:40px;height:40px;font-size:18px}.nav-btn{width:50px;height:50px;font-size:24px;font-weight:bold}.nav-btn:disabled{background-color:rgba(0,0,0,0.3);cursor:not-allowed;transform:none}#close-btn:hover{background-color:#ff0000}#image-info{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);background-color:rgba(0,0,0,0.7);color:white;padding:10px 20px;border-radius:25px;font-size:16px;z-index:10;max-width:80%;text-align:left;box-shadow:0 2px 10px rgba(0,0,0,0.3);-webkit-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap;display:flex;align-items:center}#image-caption{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-right:15px;flex:1}#image-index{font-weight:bold;opacity:0.9;white-space:nowrap;min-width:50px;text-align:right}</style>\n<div id="overlay">\n<div id="nav-controls">\n<button id="prev-btn" class="nav-btn" disabled>←</button>\n<button id="next-btn" class="nav-btn" disabled>→</button>\n</div>\n<div id="controls">\n<button id="close-btn" class="control-btn">×</button>\n<button id="rotate-btn" class="control-btn">↻</button>\n<button id="download-btn" class="control-btn">↓</button>\n</div>\n<div id="loading">Loading...</div>\n<div id="image-wrapper">\n<img id="preview-img" alt="Image Preview">\n</div>\n<div id="image-info">\n<span id="image-caption"></span>\n<span id="image-index"></span>\n</div>\n</div>\n';
  }
  connectedCallback() {
    this.#t(), this.#i(), this.#n(), this.#s();
  }
  disconnectedCallback() {
    this.#o(), this.#a(), this.observer && this.observer.disconnect();
  }
  #t() {
    (this.overlay = this.shadowRoot.getElementById("overlay")),
      (this.imageWrapper = this.shadowRoot.getElementById("image-wrapper")),
      (this.previewImg = this.shadowRoot.getElementById("preview-img")),
      (this.loadingIndicator = this.shadowRoot.getElementById("loading")),
      (this.closeBtn = this.shadowRoot.getElementById("close-btn")),
      (this.rotateBtn = this.shadowRoot.getElementById("rotate-btn")),
      (this.downloadBtn = this.shadowRoot.getElementById("download-btn")),
      (this.prevBtn = this.shadowRoot.getElementById("prev-btn")),
      (this.nextBtn = this.shadowRoot.getElementById("next-btn")),
      (this.imageCaption = this.shadowRoot.getElementById("image-caption")),
      (this.imageIndex = this.shadowRoot.getElementById("image-index")),
      (this.imageInfo = this.shadowRoot.getElementById("image-info"));
  }
  #i() {
    (this.targetSelector = this.config.targetSelector),
      this.config.allowRotate || (this.rotateBtn.style.display = "none"),
      this.config.allowDownload || (this.downloadBtn.style.display = "none");
  }
  #n() {
    (this.imageList = Array.from(
      document.querySelectorAll(this.targetSelector)
    )),
      this.observeImages(),
      this.bindClickEvents(this.imageList);
  }
  #s() {
    this.overlay.addEventListener("wheel", this.handleWheel.bind(this)),
      this.imageWrapper.addEventListener(
        "mousedown",
        this.startDrag.bind(this)
      ),
      this.closeBtn.addEventListener("click", this.closePreview.bind(this)),
      this.rotateBtn.addEventListener("click", this.rotateImage.bind(this)),
      this.downloadBtn.addEventListener("click", this.downloadImage.bind(this)),
      this.prevBtn.addEventListener("click", this.showPrevImage.bind(this)),
      this.nextBtn.addEventListener("click", this.showNextImage.bind(this)),
      document.addEventListener("keydown", this.handleKeyDown.bind(this));
  }
  #o() {
    this.overlay.removeEventListener("wheel", this.handleWheel.bind(this)),
      this.imageWrapper.removeEventListener(
        "mousedown",
        this.startDrag.bind(this)
      ),
      this.closeBtn.removeEventListener("click", this.closePreview.bind(this)),
      this.rotateBtn.removeEventListener("click", this.rotateImage.bind(this)),
      this.downloadBtn.removeEventListener(
        "click",
        this.downloadImage.bind(this)
      ),
      this.prevBtn.removeEventListener("click", this.showPrevImage.bind(this)),
      this.nextBtn.removeEventListener("click", this.showNextImage.bind(this)),
      document.removeEventListener("keydown", this.handleKeyDown.bind(this));
  }
  #r() {
    this.overlay.addEventListener("mousemove", this.doDrag.bind(this)),
      this.overlay.addEventListener("mouseup", this.endDrag.bind(this)),
      this.overlay.addEventListener("mouseleave", this.endDrag.bind(this));
  }
  #a() {
    this.overlay.removeEventListener("mousemove", this.doDrag.bind(this)),
      this.overlay.removeEventListener("mouseup", this.endDrag.bind(this)),
      this.overlay.removeEventListener("mouseleave", this.endDrag.bind(this));
  }
  resetTransform() {
    (this.currentScale = 1),
      (this.currentRotation = 0),
      (this.currentX = 0),
      (this.currentY = 0),
      this.updateImageTransform();
  }
  updateImageTransform() {
    this.imageWrapper.style.transform = `\n      translate(${this.currentX}px, ${this.currentY}px)\n      rotate(${this.currentRotation}deg)\n      scale(${this.currentScale})\n    `;
  }
  showImageByIndex(e) {
    if (e < 0 || e >= this.imageList.length) return;
    this.currentIndex = e;
    const t = this.imageList[this.currentIndex];
    this.resetTransform();
    const i = t.dataset.highres,
      n = t.src,
      s = t.alt || "";
    this.#d(!0),
      (this.previewImg.src = n),
      (this.previewImg.alt = s),
      (this.previewImg.onload = () => {
        this.#h(s), this.#l(), this.#d(!1), i && i !== n && this.#c(i);
      }),
      (this.previewImg.onerror = () => {
        this.loadingIndicator.textContent = "Failed to load image";
      }),
      (this.overlay.style.display = "flex"),
      (document.body.style.overflow = "hidden");
  }
  #c(e) {
    const t = new Image();
    (t.onload = () => {
      (this.previewImg.onload = null),
        (this.previewImg.src = e),
        (this.currentX = 0),
        (this.currentY = 0),
        this.updateImageTransform(),
        (this.previewImg.style.opacity = "0.9"),
        setTimeout(() => {
          (this.previewImg.style.opacity = "1"),
            (this.previewImg.style.transition = "opacity 0.3s ease");
        }, 50);
    }),
      (t.onerror = () => {}),
      (t.src = e);
  }
  #d(e) {
    e
      ? ((this.loadingIndicator.style.display = "block"),
        (this.imageWrapper.style.display = "none"),
        (this.imageInfo.style.display = "none"),
        (this.loadingIndicator.textContent = "Loading..."))
      : ((this.loadingIndicator.style.display = "none"),
        (this.imageWrapper.style.display = "block"));
  }
  #h(e) {
    (this.imageCaption.textContent = e),
      (this.imageIndex.textContent = `${this.currentIndex + 1} / ${
        this.imageList.length
      }`),
      (this.imageInfo.style.display =
        e || this.imageList.length > 1 ? "block" : "none");
  }
  #l() {
    (this.prevBtn.disabled = this.currentIndex <= 0),
      (this.nextBtn.disabled = this.currentIndex >= this.imageList.length - 1);
  }
  openPreview(e, t) {
    e.stopPropagation();
    const i = this.imageList.indexOf(t);
    -1 !== i && this.showImageByIndex(i);
  }
  closePreview() {
    (this.overlay.style.display = "none"), (document.body.style.overflow = "");
  }
  showNextImage() {
    this.currentIndex < this.imageList.length - 1 &&
      this.showImageByIndex(this.currentIndex + 1);
  }
  showPrevImage() {
    this.currentIndex > 0 && this.showImageByIndex(this.currentIndex - 1);
  }
  handleKeyDown(e) {
    if ("flex" === this.overlay.style.display)
      switch (e.key) {
        case "Escape":
          this.closePreview();
          break;
        case "ArrowRight":
          this.showNextImage();
          break;
        case "ArrowLeft":
          this.showPrevImage();
      }
  }
  handleWheel(e) {
    e.preventDefault();
    const t = e.deltaY > 0 ? -0.1 : 0.1,
      i = this.currentScale + t;
    i >= this.config.minScale &&
      i <= this.config.maxScale &&
      ((this.currentScale = i), this.updateImageTransform());
  }
  startDrag(e) {
    0 === e.button &&
      (e.preventDefault(),
      e.stopPropagation(),
      (this.isDragging = !0),
      (this.startX = e.clientX - this.currentX),
      (this.startY = e.clientY - this.currentY),
      this.overlay.classList.add("dragging"),
      this.#r());
  }
  doDrag(e) {
    this.isDragging &&
      (e.preventDefault(),
      e.stopPropagation(),
      (this.currentX = e.clientX - this.startX),
      (this.currentY = e.clientY - this.startY),
      this.updateImageTransform());
  }
  endDrag(e) {
    this.isDragging &&
      (e && e.stopPropagation(),
      (this.isDragging = !1),
      this.overlay.classList.remove("dragging"),
      this.#a());
  }
  rotateImage() {
    (this.currentRotation = (this.currentRotation + 90) % 360),
      this.updateImageTransform();
  }
  downloadImage() {
    const e = document.createElement("a");
    e.href = this.previewImg.src;
    const t =
      this.previewImg.alt.replace(/\s+/g, "_") ||
      `image_${this.currentIndex + 1}`;
    (e.download = `${t}.jpg`),
      document.body.appendChild(e),
      e.click(),
      document.body.removeChild(e);
  }
  observeImages() {
    (this.observer = new MutationObserver((e) => {
      e.forEach((e) => {
        e.addedNodes.forEach((e) => {
          let t = [];
          "IMG" === e.tagName && e.matches(this.targetSelector)
            ? t.push(e)
            : e.querySelectorAll &&
              (t = Array.from(e.querySelectorAll(this.targetSelector))),
            t.forEach((e) => {
              this.imageList.includes(e) ||
                (this.imageList.push(e), this.bindClickEvents([e]));
            });
        }),
          e.removedNodes.length > 0 &&
            (this.imageList = this.imageList.filter((e) =>
              document.body.contains(e)
            ));
      });
    })),
      this.observer.observe(document.body, { childList: !0, subtree: !0 });
  }
  bindClickEvents(e) {
    e.forEach((e) => {
      e.dataset.imageViewerBound ||
        (e.addEventListener("click", (t) => this.openPreview(t, e)),
        (e.dataset.imageViewerBound = "true"),
        (e.style.cursor = "zoom-in"));
    });
  }
}
customElements.define("image-viewer", e),
  document.addEventListener("DOMContentLoaded", () => {
    if (!document.querySelector("image-viewer")) {
      const t = document.getElementById("gd-image-viewer"),
        i = {};
      t
        ? ((i.targetSelector = t.dataset.targetSelector || "img"),
          (i.maxScale = parseFloat(t.dataset.maxScale) || 5),
          (i.minScale = parseFloat(t.dataset.minScale) || 0.5),
          (i.allowRotate = "false" !== t.dataset.allowRotate),
          (i.allowDownload = "false" !== t.dataset.allowDownload))
        : ((i.targetSelector = "img"),
          (i.maxScale = 5),
          (i.minScale = 0.5),
          (i.allowRotate = !0),
          (i.allowDownload = !0));
      const n = new e(i);
      document.body.appendChild(n);
    }
  });
